define("tiny_media/plugin",["exports","editor_tiny/loader","core/notification","./upload-handler"],(function(_exports,_loader,_notification,_uploadHandler){var obj;
/**
   * Tiny Media plugin for Moodle.
   *
   * @module      tiny_media/plugin
   * @copyright   2022 Andrew Lyons <andrew@nicols.co.uk>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_uploadHandler=(obj=_uploadHandler)&&obj.__esModule?obj:{default:obj};const askTheQuestion=(editor,question)=>{(0,_notification.saveCancel)("Title",question,"Yes",(()=>{editor.setContent('<span data-identifier="SOMEVALUE">'+editor.getContent()+"</span>"),editor.insertContent("Inserted some content! :)")}))};var _default=new Promise((async resolve=>{const tinyMCE=await(0,_loader.getTinyMCE)();return tinyMCE.PluginManager.add("tiny_media/plugin",(editor=>(editor.ui.registry.addButton("tiny_media/image",{icon:"image",text:"Image...",onAction:function(){askTheQuestion(editor,"Did you click the button?")}}),editor.ui.registry.addMenuItem("tiny_media/image",{icon:"image",text:"Image...",onAction:function(){askTheQuestion(editor,"Did you click the Menu item?")}}),editor.ui.registry.addToggleButton("tiny_media/imageimage",{icon:"image",tooltip:"Insert/edit image",onAction:()=>{askTheQuestion(editor,"Did you click the Menu item?")},onSetup:buttonApi=>{var a;return buttonApi.setActive((a=(editor=>{const imgElm=editor.selection.getNode(),figureElm=editor.dom.getParent(imgElm,"figure.image");return figureElm?editor.dom.select("img",figureElm)[0]:imgElm&&("IMG"!==imgElm.nodeName||(imgElm=>"IMG"===imgElm.nodeName&&(imgElm.hasAttribute("data-mce-object")||imgElm.hasAttribute("data-mce-placeholder")))(imgElm))?null:imgElm})(editor),!(a=>null==a)(a))),editor.selection.selectorChangedWithUnbind("img:not([data-mce-object]):not([data-mce-placeholder]),figure.image",buttonApi.setActive).unbind}}),editor.ui.registry.addButton("tiny_media/video",{text:"Video",onAction:function(){askTheQuestion(editor,"Did you click the button?")}}),editor.ui.registry.addMenuItem("tiny_media/video",{text:"Insert video",onAction:function(){askTheQuestion(editor,"Did you click the Menu item?")}}),{name:"Media plugin",url:"https://moodle.org/"}))),resolve(["tiny_media/plugin",{configure:()=>({images_upload_handler:(blobInfo,progress)=>(0,_uploadHandler.default)(tinyMCE.activeEditor,blobInfo,progress),file_picker_callback:(cb,value,meta)=>{const editor=tinyMCE.activeEditor;if(editor.moodleOptions.filepicker[meta.filetype]){const options={...editor.moodleOptions.filepicker[meta.filetype],formcallback:newFile=>{cb(newFile.url,{alt:newFile.file})}};M.core_filepicker.show(Y,options)}}})}]),tinyMCE}));return _exports.default=_default,_exports.default}));

//# sourceMappingURL=plugin.min.js.map